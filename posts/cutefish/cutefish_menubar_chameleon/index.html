<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Cutefish Menu Bar Chameleon - Reion's Think</title>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=author content="StaticMania"><meta name=generator content="Hugo 0.146.1"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/font-awesome/css/font-awesome.min.css><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;500;600;700" rel=stylesheet><link href=/scss/style.min.css rel=stylesheet><link rel="shortcut icon" href=/images/logo.svg type=image/x-icon><link rel=icon href=/images/logo.svg type=image/x-icon></head><body><nav class="navbar navbar-expand-lg site-navigation"><div class=container><a class=navbar-brand href=/><img src=/images/logo.svg alt=logo>
</a><button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#sitenavbar>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button><div class="collapse navbar-collapse" id=sitenavbar><ul class="navbar-nav ml-auto main-nav"><li class=nav-item><a class=nav-link href=/>Home</a></li><li class=nav-item><a class=nav-link href=/posts>Posts</a></li><li class=nav-item><a class=nav-link href=/about>About</a></li></ul></div></div></nav><main><section class="site-blog details"><div class=container><div class="row justify-content-center"><div class=col-lg-8><article class=site-blog-details><p><span>July 25, 2022</span> by <span>Reion</span></p><h2 class=blog-title>Cutefish Menu Bar Chameleon</h2><p>A new feature introduced in the macOS Big Sur version of the top menu bar is that the menu bar background color adapts to the desktop wallpaper for a more integrated effect than before.</p><p>The actual effect is more than just making the background transparent + blurred, it will extract the theme color from the top area of the wallpaper image.</p><h1 id=implementation-method>Implementation method</h1><p>Add up all the rgb values in the image data and divide them by the area of the image to find the average.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>QImage <span style=color:#a6e22e>img</span>(<span style=color:#e6db74>&#34;wallpaper_file_name.jpg&#34;</span>);
</span></span><span style=display:flex><span>QSize size <span style=color:#f92672>=</span> img.size();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span> sumR <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, sumG <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, sumB <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> measureArea <span style=color:#f92672>=</span> size.width() <span style=color:#f92672>*</span> size.height();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Iterate over each coordinate of the image
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> y <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; y <span style=color:#f92672>&lt;</span> size.height(); <span style=color:#f92672>++</span>y) {
</span></span><span style=display:flex><span>    QRgb <span style=color:#f92672>*</span>line <span style=color:#f92672>=</span> (QRgb <span style=color:#f92672>*</span>)img.scanLine(y);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; x <span style=color:#f92672>&lt;</span> size.width(); <span style=color:#f92672>++</span>x) {
</span></span><span style=display:flex><span>        sumR <span style=color:#f92672>+=</span> qRed(line[x]);
</span></span><span style=display:flex><span>        sumG <span style=color:#f92672>+=</span> qGreen(line[x]);
</span></span><span style=display:flex><span>        sumB <span style=color:#f92672>+=</span> qBlue(line[x]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sumR <span style=color:#f92672>/=</span> measureArea;
</span></span><span style=display:flex><span>sumG <span style=color:#f92672>/=</span> measureArea;
</span></span><span style=display:flex><span>sumB <span style=color:#f92672>/=</span> measureArea;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>QColor themeColor <span style=color:#f92672>=</span> QColor(sumR, sumG, sumB);
</span></span></code></pre></div><p>Font color adaptation to background scheme:</p><div class="goat svg-container"><svg font-family="Menlo,Lucida Console,monospace" viewBox="0 0 496 25"><g transform="translate(8,16)"><circle cx="24" cy="0" r="6" stroke="currentcolor" fill="currentcolor"/><circle cx="120" cy="0" r="6" stroke="currentcolor" fill="currentcolor"/><circle cx="216" cy="0" r="6" stroke="currentcolor" fill="currentcolor"/><text text-anchor="middle" x="0" y="4" fill="currentcolor" style="font-size:1em">(</text><text text-anchor="middle" x="8" y="4" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="40" y="4" fill="currentcolor" style="font-size:1em">0</text><text text-anchor="middle" x="48" y="4" fill="currentcolor" style="font-size:1em">.</text><text text-anchor="middle" x="56" y="4" fill="currentcolor" style="font-size:1em">2</text><text text-anchor="middle" x="64" y="4" fill="currentcolor" style="font-size:1em">9</text><text text-anchor="middle" x="72" y="4" fill="currentcolor" style="font-size:1em">9</text><text text-anchor="middle" x="88" y="4" fill="currentcolor" style="font-size:1em">+</text><text text-anchor="middle" x="104" y="4" fill="currentcolor" style="font-size:1em">g</text><text text-anchor="middle" x="136" y="4" fill="currentcolor" style="font-size:1em">0</text><text text-anchor="middle" x="144" y="4" fill="currentcolor" style="font-size:1em">.</text><text text-anchor="middle" x="152" y="4" fill="currentcolor" style="font-size:1em">5</text><text text-anchor="middle" x="160" y="4" fill="currentcolor" style="font-size:1em">8</text><text text-anchor="middle" x="168" y="4" fill="currentcolor" style="font-size:1em">7</text><text text-anchor="middle" x="184" y="4" fill="currentcolor" style="font-size:1em">+</text><text text-anchor="middle" x="200" y="4" fill="currentcolor" style="font-size:1em">b</text><text text-anchor="middle" x="232" y="4" fill="currentcolor" style="font-size:1em">0</text><text text-anchor="middle" x="240" y="4" fill="currentcolor" style="font-size:1em">.</text><text text-anchor="middle" x="248" y="4" fill="currentcolor" style="font-size:1em">1</text><text text-anchor="middle" x="256" y="4" fill="currentcolor" style="font-size:1em">1</text><text text-anchor="middle" x="264" y="4" fill="currentcolor" style="font-size:1em">4</text><text text-anchor="middle" x="272" y="4" fill="currentcolor" style="font-size:1em">)</text><text text-anchor="middle" x="288" y="4" fill="currentcolor" style="font-size:1em">></text><text text-anchor="middle" x="304" y="4" fill="currentcolor" style="font-size:1em">1</text><text text-anchor="middle" x="312" y="4" fill="currentcolor" style="font-size:1em">8</text><text text-anchor="middle" x="320" y="4" fill="currentcolor" style="font-size:1em">6</text><text text-anchor="middle" x="336" y="4" fill="currentcolor" style="font-size:1em">?</text><text text-anchor="middle" x="352" y="4" fill="currentcolor" style="font-size:1em">"</text><text text-anchor="middle" x="360" y="4" fill="currentcolor" style="font-size:1em">b</text><text text-anchor="middle" x="368" y="4" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="376" y="4" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="384" y="4" fill="currentcolor" style="font-size:1em">c</text><text text-anchor="middle" x="392" y="4" fill="currentcolor" style="font-size:1em">k</text><text text-anchor="middle" x="400" y="4" fill="currentcolor" style="font-size:1em">"</text><text text-anchor="middle" x="416" y="4" fill="currentcolor" style="font-size:1em">:</text><text text-anchor="middle" x="432" y="4" fill="currentcolor" style="font-size:1em">"</text><text text-anchor="middle" x="440" y="4" fill="currentcolor" style="font-size:1em">w</text><text text-anchor="middle" x="448" y="4" fill="currentcolor" style="font-size:1em">h</text><text text-anchor="middle" x="456" y="4" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="464" y="4" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="472" y="4" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="480" y="4" fill="currentcolor" style="font-size:1em">"</text></g></svg></div><h1 id=showcase>Showcase</h1><p><img src=FPGrb-KaQAEWhmV.jpeg alt></p><p><img src=FPGrb-LakAMQKoS.jpeg alt></p></article></div></div></div></section><section class="site-blog details"><div class=container id=reion_blog_comments><div class="row justify-content-center"></div></div></section><script>const isDarkTheme=document.querySelector("body").classList.contains("theme-dark"),themeName=isDarkTheme?"dark":"light_protanopia",com_script=document.createElement("script");com_script.src="https://giscus.app/client.js",com_script.dataset.repo="reionwong/blog_comments",com_script.dataset.repoId="R_kgDOJrDnMQ",com_script.dataset.category="General",com_script.dataset.categoryId="DIC_kwDOJrDnMc4CW8lY",com_script.dataset.mapping="pathname",com_script.dataset.strict="0",com_script.dataset.reactionsEnabled="1",com_script.dataset.emitMetadata="0",com_script.dataset.inputPosition="bottom",com_script.dataset.theme=themeName,com_script.dataset.lang="en",com_script.dataset.loading="lazy",com_script.crossOrigin="anonymous",com_script.async=!0,document.getElementById("reion_blog_comments").appendChild(com_script)</script></main><footer class=site-footer><div class=container><div class=row><div class="col-lg-3 col-md-6"><div class=site-footer-widget><h5 class=site-footer-widget-title>Contact Info</h5><p class=site-footer-widget-description>reionwong@gmail.com<br><a href=tel:></a><br><a href=mailto:></a></p></div></div><div class="col-lg-2 col-md-6"><div class=site-footer-widget><h5 class=site-footer-widget-title>Sitemap</h5><ul class=site-footer-widget-links><li><a href=/about>About</a></li></ul></div></div><div class="col-lg-2 col-md-6"><div class=site-footer-widget><h5 class=site-footer-widget-title>Related</h5><ul class=site-footer-widget-links><li><a href=https://github.com/reionwong target=_blank>Github</a></li><li><a href=https://twitter.com/reionwong target=_blank>Twitter</a></li></ul></div></div><div class="col-lg-3 col-md-6"><div class=site-footer-widget><h5 class=site-footer-widget-title>Blogroll</h5><ul class=site-footer-widget-links><li><a href=https://felixc.at/ target=_blank>Felix’s Blog</a></li><li><a href=https://blog.han-li.cn/ target=_blank>Han Li’s Blog</a></li><li><a href=https://hiif.ong/ target=_blank>hiifong</a></li></ul></div></div><div class="col-lg-2 col-12"><a href=#top class=site-footer-widget-top><img src=/images/to-top.svg alt=back-to-top><p>To the top</p></a></div><div class=col-12><div class=site-footer-copyright><p>© Copyright 2025 - All Rights Reserved by Reion Wong</p></div></div></div></div></footer><script src=/js/vendor.min.js></script><script src=/js/script.min.js></script></body></html>